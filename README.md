<div align="center">

# üîó opencode-hashline

**–ö–æ–Ω—Ç–µ–Ω—Ç–Ω–æ-–∞–¥—Ä–µ—Å—É–µ–º–æ–µ —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç—Ä–æ–∫ –¥–ª—è —Ç–æ—á–Ω–æ–≥–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–¥–∞ —Å –ø–æ–º–æ—â—å—é AI**

[![CI](https://github.com/izzzzzi/opencode-hashline/actions/workflows/ci.yml/badge.svg)](https://github.com/izzzzzi/opencode-hashline/actions/workflows/ci.yml)
[![Release](https://github.com/izzzzzi/opencode-hashline/actions/workflows/release.yml/badge.svg)](https://github.com/izzzzzi/opencode-hashline/actions/workflows/release.yml)
[![npm version](https://img.shields.io/npm/v/opencode-hashline.svg?style=flat&colorA=18181B&colorB=28CF8D)](https://www.npmjs.com/package/opencode-hashline)
[![npm downloads](https://img.shields.io/npm/dm/opencode-hashline.svg?style=flat&colorA=18181B&colorB=28CF8D)](https://www.npmjs.com/package/opencode-hashline)
[![GitHub release](https://img.shields.io/github/v/release/izzzzzi/opencode-hashline?style=flat&colorA=18181B&colorB=28CF8D)](https://github.com/izzzzzi/opencode-hashline/releases)
[![License: MIT](https://img.shields.io/badge/License-MIT-blue.svg?style=flat&colorA=18181B&colorB=28CF8D)](LICENSE)
[![semantic-release](https://img.shields.io/badge/semantic--release-auto-e10079?style=flat&colorA=18181B)](https://github.com/semantic-release/semantic-release)
[![TypeScript](https://img.shields.io/badge/TypeScript-5.9-blue?style=flat&colorA=18181B&colorB=3178C6)](https://www.typescriptlang.org/)
[![Node.js](https://img.shields.io/badge/Node.js-ESM-green?style=flat&colorA=18181B&colorB=339933)](https://nodejs.org/)

**üá∑üá∫ –†—É—Å—Å–∫–∏–π** | [üá¨üáß English](README.en.md)

<br />

*Hashline-–ø–ª–∞–≥–∏–Ω –¥–ª—è [OpenCode](https://github.com/anomalyco/opencode) ‚Äî –∞–Ω–Ω–æ—Ç–∏—Ä—É–µ—Ç –∫–∞–∂–¥—É—é —Å—Ç—Ä–æ–∫—É —Ñ–∞–π–ª–∞ –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–º —Ö–µ—à-—Ç–µ–≥–æ–º, —á—Ç–æ–±—ã AI –º–æ–≥ —Å—Å—ã–ª–∞—Ç—å—Å—è –Ω–∞ –∫–æ–¥ –∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –µ–≥–æ —Å —Ö–∏—Ä—É—Ä–≥–∏—á–µ—Å–∫–æ–π —Ç–æ—á–Ω–æ—Å—Ç—å—é.*

</div>

---

## üìñ –ß—Ç–æ —Ç–∞–∫–æ–µ Hashline?

Hashline –∞–Ω–Ω–æ—Ç–∏—Ä—É–µ—Ç –∫–∞–∂–¥—É—é —Å—Ç—Ä–æ–∫—É —Ñ–∞–π–ª–∞ –∫–æ—Ä–æ—Ç–∫–∏–º –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–º hex-—Ö–µ—à–µ–º. –ö–æ–≥–¥–∞ AI —á–∏—Ç–∞–µ—Ç —Ñ–∞–π–ª, –æ–Ω –≤–∏–¥–∏—Ç:

```
#HL 1:a3f|function hello() {
#HL 2:f1c|  return "world";
#HL 3:0e7|}
```

> **–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –î–ª–∏–Ω–∞ —Ö–µ—à–∞ –∞–¥–∞–ø—Ç–∏–≤–Ω–∞—è ‚Äî –æ–Ω–∞ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–∞ (2 —Å–∏–º–≤–æ–ª–∞ –¥–ª—è ‚â§256 —Å—Ç—Ä–æ–∫, 3 —Å–∏–º–≤–æ–ª–∞ –¥–ª—è ‚â§4096 —Å—Ç—Ä–æ–∫, 4 —Å–∏–º–≤–æ–ª–∞ –¥–ª—è >4096 —Å—Ç—Ä–æ–∫). –í –ø—Ä–∏–º–µ—Ä–∞—Ö –Ω–∏–∂–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è 3-—Å–∏–º–≤–æ–ª—å–Ω—ã–µ —Ö–µ—à–∏. –ü—Ä–µ—Ñ–∏–∫—Å `#HL ` –∑–∞—â–∏—â–∞–µ—Ç –æ—Ç –ª–æ–∂–Ω—ã—Ö —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏–π –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —Ö–µ—à–µ–π –∏ —è–≤–ª—è–µ—Ç—Å—è –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–º.

AI-–º–æ–¥–µ–ª—å –º–æ–∂–µ—Ç —Å—Å—ã–ª–∞—Ç—å—Å—è –Ω–∞ —Å—Ç—Ä–æ–∫–∏ –ø–æ –∏—Ö —Ö–µ—à-—Ç–µ–≥–∞–º –¥–ª—è —Ç–æ—á–Ω–æ–≥–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:

- **¬´–ó–∞–º–µ–Ω–∏—Ç—å —Å—Ç—Ä–æ–∫—É `2:f1c`¬ª** ‚Äî —É–∫–∞–∑–∞—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é —Å—Ç—Ä–æ–∫—É –æ–¥–Ω–æ–∑–Ω–∞—á–Ω–æ
- **¬´–ó–∞–º–µ–Ω–∏—Ç—å –±–ª–æ–∫ –æ—Ç `1:a3f` –¥–æ `3:0e7`¬ª** ‚Äî —É–∫–∞–∑–∞—Ç—å –¥–∏–∞–ø–∞–∑–æ–Ω —Å—Ç—Ä–æ–∫
- **¬´–í—Å—Ç–∞–≤–∏—Ç—å –ø–æ—Å–ª–µ `3:0e7`¬ª** ‚Äî –≤—Å—Ç–∞–≤–∏—Ç—å –≤ —Ç–æ—á–Ω–æ–µ –º–µ—Å—Ç–æ

### ü§î –ü–æ—á–µ–º—É —ç—Ç–æ –ø–æ–º–æ–≥–∞–µ—Ç?

Hashline —Ä–µ—à–∞–µ—Ç —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç–∞–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –¥–≤—É—Ö —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ø–æ–¥—Ö–æ–¥–æ–≤ –∫ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—é —Ñ–∞–π–ª–æ–≤ AI:

- **`str_replace`** —Ç—Ä–µ–±—É–µ—Ç –∞–±—Å–æ–ª—é—Ç–Ω–æ —Ç–æ—á–Ω–æ–≥–æ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è `old_string`. –õ—é–±–æ–π –ª–∏—à–Ω–∏–π –ø—Ä–æ–±–µ–ª, –Ω–µ–≤–µ—Ä–Ω—ã–π –æ—Ç—Å—Ç—É–ø –∏–ª–∏ –¥—É–±–ª–∏—Ä—É—é—â–∏–µ—Å—è —Å—Ç—Ä–æ–∫–∏ –≤ —Ñ–∞–π–ª–µ ‚Äî –∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è –æ—à–∏–±–∫–æ–π ¬´String to replace not found¬ª. –≠—Ç–æ –Ω–∞—Å—Ç–æ–ª—å–∫–æ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—ë–Ω–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞, —á—Ç–æ —É –Ω–µ—ë –µ—Å—Ç—å [–º–µ–≥–∞—Ç—Ä–µ–¥ –Ω–∞ 27+ —Ç–∏–∫–µ—Ç–æ–≤ –Ω–∞ GitHub](https://github.com/anthropics/claude-code/issues).
- **`apply_patch`** (unified diff) —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –Ω–∞ –º–æ–¥–µ–ª—è—Ö, —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ –æ–±—É—á–µ–Ω–Ω—ã—Ö —ç—Ç–æ–º—É —Ñ–æ—Ä–º–∞—Ç—É. –ù–∞ –¥—Ä—É–≥–∏—Ö –º–æ–¥–µ–ª—è—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∫–∞—Ç–∞—Å—Ç—Ä–æ—Ñ–∏—á–µ—Å–∫–∏–µ: Grok 4 –ø—Ä–æ–≤–∞–ª–∏–≤–∞–µ—Ç **50.7%** –ø–∞—Ç—á–µ–π, GLM-4.7 ‚Äî **46.2%** ([–∏—Å—Ç–æ—á–Ω–∏–∫](https://habr.com/ru/companies/bothub/news/995986/)).

Hashline –∞–¥—Ä–µ—Å—É–µ—Ç –∫–∞–∂–¥—É—é —Å—Ç—Ä–æ–∫—É —É–Ω–∏–∫–∞–ª—å–Ω—ã–º —Ö–µ—à–µ–º `lineNumber:hash`. –ù–∏–∫–∞–∫–æ–≥–æ —Å—Ç—Ä–æ–∫–æ–≤–æ–≥–æ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è, –Ω–∏–∫–∞–∫–æ–π –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è –º–æ–¥–µ–ª–∏ ‚Äî —Ç–æ–ª—å–∫–æ —Ç–æ—á–Ω–∞—è, –≤–µ—Ä–∏—Ñ–∏—Ü–∏—Ä—É–µ–º–∞—è –∞–¥—Ä–µ—Å–∞—Ü–∏—è.

---

## ‚ú® –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### üìè –ê–¥–∞–ø—Ç–∏–≤–Ω–∞—è –¥–ª–∏–Ω–∞ —Ö–µ—à–∞

–î–ª–∏–Ω–∞ —Ö–µ—à–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∞–¥–∞–ø—Ç–∏—Ä—É–µ—Ç—Å—è –∫ —Ä–∞–∑–º–µ—Ä—É —Ñ–∞–π–ª–∞ –¥–ª—è –º–∏–Ω–∏–º–∏–∑–∞—Ü–∏–∏ –∫–æ–ª–ª–∏–∑–∏–π:

| –†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ | –î–ª–∏–Ω–∞ —Ö–µ—à–∞ | –í–æ–∑–º–æ–∂–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π |
|-------------|:----------:|:------------------:|
| ‚â§ 256 —Å—Ç—Ä–æ–∫ | 2 hex-—Å–∏–º–≤–æ–ª–∞ | 256 |
| ‚â§ 4 096 —Å—Ç—Ä–æ–∫ | 3 hex-—Å–∏–º–≤–æ–ª–∞ | 4 096 |
| > 4 096 —Å—Ç—Ä–æ–∫ | 4 hex-—Å–∏–º–≤–æ–ª–∞ | 65 536 |

### üè∑Ô∏è –ú–∞–≥–∏—á–µ—Å–∫–∏–π –ø—Ä–µ—Ñ–∏–∫—Å (`#HL `)

–°—Ç—Ä–æ–∫–∏ –∞–Ω–Ω–æ—Ç–∏—Ä—É—é—Ç—Å—è –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–º –ø—Ä–µ—Ñ–∏–∫—Å–æ–º (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: `#HL `), —á—Ç–æ–±—ã –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—Ç–∏—Ç—å –ª–æ–∂–Ω—ã–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏—è –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —Ö–µ—à–µ–π. –≠—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ —Å—Ç—Ä–æ–∫–∏ –¥–∞–Ω–Ω—ã—Ö –≤—Ä–æ–¥–µ `1:ab|some data` –Ω–µ –±—É–¥—É—Ç —Å–ª—É—á–∞–π–Ω–æ –æ–±—Ä–µ–∑–∞–Ω—ã.

```
#HL 1:a3|function hello() {
#HL 2:f1|  return "world";
#HL 3:0e|}
```

–ü—Ä–µ—Ñ–∏–∫—Å –º–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –∏–ª–∏ –æ—Ç–∫–ª—é—á–∏—Ç—å –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏:

```typescript
// –ö–∞—Å—Ç–æ–º–Ω—ã–π –ø—Ä–µ—Ñ–∏–∫—Å
const hl = createHashline({ prefix: ">> " });

// –û—Ç–∫–ª—é—á–∏—Ç—å –ø—Ä–µ—Ñ–∏–∫—Å (legacy-—Ñ–æ—Ä–º–∞—Ç: "1:a3|code")
const hl = createHashline({ prefix: false });
```

### üíæ LRU-–∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ

–í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π LRU-–∫–µ—à (`filePath ‚Üí annotatedContent`) —Å –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–º —Ä–∞–∑–º–µ—Ä–æ–º (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 100 —Ñ–∞–π–ª–æ–≤). –ü—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–º —á—Ç–µ–Ω–∏–∏ —Ç–æ–≥–æ –∂–µ —Ñ–∞–π–ª–∞ —Å –Ω–µ–∏–∑–º–µ–Ω—ë–Ω–Ω—ã–º —Å–æ–¥–µ—Ä–∂–∏–º—ã–º –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –∫–µ—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç. –ö–µ—à –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–Ω–≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç—Å—è –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ —Ñ–∞–π–ª–∞.

### ‚úÖ –í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è —Ö–µ—à–µ–π

–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–≥–æ, —á—Ç–æ —Å—Ç—Ä–æ–∫–∞ –Ω–µ –∏–∑–º–µ–Ω–∏–ª–∞—Å—å —Å –º–æ–º–µ–Ω—Ç–∞ —á—Ç–µ–Ω–∏—è ‚Äî –∑–∞—â–∏—Ç–∞ –æ—Ç race conditions:

```typescript
import { verifyHash } from "opencode-hashline";

const result = verifyHash(2, "f1c", currentContent);
if (!result.valid) {
  console.error(result.message); // "Hash mismatch at line 2: ..."
}
```

–í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è —Ö–µ—à–µ–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –¥–ª–∏–Ω—É –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω–æ–π —Ö–µ—à-—Å—Å—ã–ª–∫–∏ (–∞ –Ω–µ —Ç–µ–∫—É—â–∏–π —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞), –ø–æ—ç—Ç–æ–º—É —Å—Å—ã–ª–∫–∞ –≤—Ä–æ–¥–µ `2:f1` –æ—Å—Ç–∞—ë—Ç—Å—è –≤–∞–ª–∏–¥–Ω–æ–π –¥–∞–∂–µ –µ—Å–ª–∏ —Ñ–∞–π–ª –≤—ã—Ä–æ—Å.

### üîç –ß—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∫ –æ—Ç—Å—Ç—É–ø–∞–º

–í—ã—á–∏—Å–ª–µ–Ω–∏–µ —Ö–µ—à–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `trimEnd()` (–∞ –Ω–µ `trim()`), –ø–æ—ç—Ç–æ–º—É –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤–µ–¥—É—â–∏—Ö –ø—Ä–æ–±–µ–ª–æ–≤ (–æ—Ç—Å—Ç—É–ø–æ–≤) –æ–±–Ω–∞—Ä—É–∂–∏–≤–∞—é—Ç—Å—è –∫–∞–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ, –∞ –∑–∞–≤–µ—Ä—à–∞—é—â–∏–µ –ø—Ä–æ–±–µ–ª—ã –∏–≥–Ω–æ—Ä–∏—Ä—É—é—Ç—Å—è.

### üìê Range-–æ–ø–µ—Ä–∞—Ü–∏–∏

–†–µ–∑–æ–ª–≤–∏–Ω–≥ –∏ –∑–∞–º–µ–Ω–∞ –¥–∏–∞–ø–∞–∑–æ–Ω–æ–≤ —Å—Ç—Ä–æ–∫ –ø–æ —Ö–µ—à-—Å—Å—ã–ª–∫–∞–º:

```typescript
import { resolveRange, replaceRange } from "opencode-hashline";

// –ü–æ–ª—É—á–∏—Ç—å —Å—Ç—Ä–æ–∫–∏ –º–µ–∂–¥—É –¥–≤—É–º—è —Ö–µ—à-—Å—Å—ã–ª–∫–∞–º–∏
const range = resolveRange("1:a3f", "3:0e7", content);
console.log(range.lines); // ["function hello() {", '  return "world";', "}"]

// –ó–∞–º–µ–Ω–∏—Ç—å –¥–∏–∞–ø–∞–∑–æ–Ω –Ω–æ–≤—ã–º —Å–æ–¥–µ—Ä–∂–∏–º—ã–º
const newContent = replaceRange(
  "1:a3f", "3:0e7", content,
  "function goodbye() {\n  return 'farewell';\n}"
);
```

### ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–µ–º–æ—Å—Ç—å

–°–æ–∑–¥–∞–Ω–∏–µ –∫–∞—Å—Ç–æ–º–Ω—ã—Ö —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤ Hashline —Å –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏:

```typescript
import { createHashline } from "opencode-hashline";

const hl = createHashline({
  exclude: ["**/node_modules/**", "**/*.min.js"],
  maxFileSize: 512_000,  // 512 –ö–ë
  hashLength: 3,         // –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ 3-—Å–∏–º–≤–æ–ª—å–Ω—ã–µ —Ö–µ—à–∏
  cacheSize: 200,        // –∫–µ—à–∏—Ä–æ–≤–∞—Ç—å –¥–æ 200 —Ñ–∞–π–ª–æ–≤
  prefix: "#HL ",        // –º–∞–≥–∏—á–µ—Å–∫–∏–π –ø—Ä–µ—Ñ–∏–∫—Å (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
});

// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–Ω–æ–≥–æ —ç–∫–∑–µ–º–ø–ª—è—Ä–∞
const annotated = hl.formatFileWithHashes(content, "src/app.ts");
const isExcluded = hl.shouldExclude("node_modules/foo.js"); // true
```

#### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –¢–∏–ø | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|-----|:------------:|----------|
| `exclude` | `string[]` | –°–º. –Ω–∏–∂–µ | Glob-–ø–∞—Ç—Ç–µ—Ä–Ω—ã –¥–ª—è –∏—Å–∫–ª—é—á–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤ |
| `maxFileSize` | `number` | `1_000_000` | –ú–∞–∫—Å. —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ –≤ –±–∞–π—Ç–∞—Ö |
| `hashLength` | `number \| undefined` | `undefined` (–∞–¥–∞–ø—Ç–∏–≤–Ω–æ) | –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ —Ö–µ—à–∞ |
| `cacheSize` | `number` | `100` | –ú–∞–∫—Å. —Ñ–∞–π–ª–æ–≤ –≤ LRU-–∫–µ—à–µ |
| `prefix` | `string \| false` | `"#HL "` | –ü—Ä–µ—Ñ–∏–∫—Å —Å—Ç—Ä–æ–∫–∏ (`false` –¥–ª—è –æ—Ç–∫–ª—é—á–µ–Ω–∏—è) |

–ü–∞—Ç—Ç–µ—Ä–Ω—ã –∏—Å–∫–ª—é—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: lock-—Ñ–∞–π–ª—ã, `node_modules`, –º–∏–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã, –±–∏–Ω–∞—Ä–Ω—ã–µ —Ñ–∞–π–ª—ã (–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è, —à—Ä–∏—Ñ—Ç—ã, –∞—Ä—Ö–∏–≤—ã –∏ —Ç.–¥.).

---

## üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
npm install opencode-hashline
```

---

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–î–æ–±–∞–≤—å—Ç–µ –ø–ª–∞–≥–∏–Ω –≤ –≤–∞—à `opencode.json`:

```json
{
  "$schema": "https://opencode.ai/config.json",
  "plugin": ["opencode-hashline"]
}
```

### –§–∞–π–ª—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

–ü–ª–∞–≥–∏–Ω –∑–∞–≥—Ä—É–∂–∞–µ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –∏–∑ —Å–ª–µ–¥—É—é—â–∏—Ö –º–µ—Å—Ç (–≤ –ø–æ—Ä—è–¥–∫–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞, –±–æ–ª–µ–µ –ø–æ–∑–¥–Ω–∏–µ –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞—é—Ç —Ä–∞–Ω–Ω–∏–µ):

| –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç | –†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ | –û–±–ª–∞—Å—Ç—å |
|:---------:|-------------|---------|
| 1 | `~/.config/opencode/opencode-hashline.json` | –ì–ª–æ–±–∞–ª—å–Ω–∞—è (–≤—Å–µ –ø—Ä–æ–µ–∫—Ç—ã) |
| 2 | `<project>/opencode-hashline.json` | –õ–æ–∫–∞–ª—å–Ω–∞—è (–ø—Ä–æ–µ–∫—Ç) |
| 3 | –ü—Ä–æ–≥—Ä–∞–º–º–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ `createHashlinePlugin()` | –ê—Ä–≥—É–º–µ–Ω—Ç —Ñ–∞–±—Ä–∏–∫–∏ |

–ü—Ä–∏–º–µ—Ä `opencode-hashline.json`:

```json
{
  "exclude": ["**/node_modules/**", "**/*.min.js"],
  "maxFileSize": 1048576,
  "hashLength": 0,
  "cacheSize": 100,
  "prefix": "#HL "
}
```

–í–æ—Ç –∏ –≤—Å—ë! –ü–ª–∞–≥–∏–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:

| # | –î–µ–π—Å—Ç–≤–∏–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
|:-:|----------|----------|
| 1 | üìù **–ê–Ω–Ω–æ—Ç–∏—Ä—É–µ—Ç —á—Ç–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤** | –ü—Ä–∏ —á—Ç–µ–Ω–∏–∏ —Ñ–∞–π–ª–∞ AI –∫–∞–∂–¥–∞—è —Å—Ç—Ä–æ–∫–∞ –ø–æ–ª—É—á–∞–µ—Ç `#HL` —Ö–µ—à-–ø—Ä–µ—Ñ–∏–∫—Å |
| 2 | üìé **–ê–Ω–Ω–æ—Ç–∏—Ä—É–µ—Ç `@file` —É–ø–æ–º–∏–Ω–∞–Ω–∏—è** | –§–∞–π–ª—ã, –ø—Ä–∏–∫—Ä–µ–ø–ª—ë–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ `@filename` –≤ –ø—Ä–æ–º–ø—Ç–µ, —Ç–æ–∂–µ –∞–Ω–Ω–æ—Ç–∏—Ä—É—é—Ç—Å—è —Ö–µ—à–ª–∞–π–Ω–∞–º–∏ |
| 3 | ‚úÇÔ∏è **–£–±–∏—Ä–∞–µ—Ç —Ö–µ—à-–ø—Ä–µ—Ñ–∏–∫—Å—ã –ø—Ä–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏** | –ü—Ä–∏ –∑–∞–ø–∏—Å–∏/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ —Ñ–∞–π–ª–∞ —Ö–µ—à-–ø—Ä–µ—Ñ–∏–∫—Å—ã —É–¥–∞–ª—è—é—Ç—Å—è –ø–µ—Ä–µ–¥ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏–π |
| 4 | üß† **–í–Ω–µ–¥—Ä—è–µ—Ç –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –≤ —Å–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç** | AI –ø–æ–ª—É—á–∞–µ—Ç –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏–∏ –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é hashline-—Å—Å—ã–ª–æ–∫ |
| 5 | üíæ **–ö–µ—à–∏—Ä—É–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã** | –ü–æ–≤—Ç–æ—Ä–Ω—ã–µ —á—Ç–µ–Ω–∏—è —Ç–æ–≥–æ –∂–µ —Ñ–∞–π–ª–∞ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç –∫–µ—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏ |
| 6 | üîç **–§–∏–ª—å—Ç—Ä—É–µ—Ç –ø–æ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—É** | –¢–æ–ª—å–∫–æ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã —á—Ç–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä `read_file`, `cat`, `view`) –ø–æ–ª—É—á–∞—é—Ç –∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏; –æ—Å—Ç–∞–ª—å–Ω—ã–µ –Ω–µ –∑–∞—Ç—Ä–∞–≥–∏–≤–∞—é—Ç—Å—è |
| 7 | ‚öôÔ∏è **–£—á–∏—Ç—ã–≤–∞–µ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é** | –ò—Å–∫–ª—é—á—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã –∏ —Ñ–∞–π–ª—ã, –ø—Ä–µ–≤—ã—à–∞—é—â–∏–µ `maxFileSize`, –ø—Ä–æ–ø—É—Å–∫–∞—é—Ç—Å—è |
| 8 | üß© **–†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç `hashline_edit` tool** | –ü—Ä–∏–º–µ–Ω—è–µ—Ç replace/delete/insert –ø–æ hash-—Å—Å—ã–ª–∫–∞–º –±–µ–∑ —Ç–æ—á–Ω–æ–≥–æ `old_string`-–º–∞—Ç—á–∏–Ω–≥–∞ |

---

## üõ†Ô∏è –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –í—ã—á–∏—Å–ª–µ–Ω–∏–µ —Ö–µ—à–∞

–•–µ—à –∫–∞–∂–¥–æ–π —Å—Ç—Ä–æ–∫–∏ –≤—ã—á–∏—Å–ª—è–µ—Ç—Å—è –∏–∑:
- **0-based –∏–Ω–¥–µ–∫—Å–∞** —Å—Ç—Ä–æ–∫–∏
- **–°–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ —Å—Ç—Ä–æ–∫–∏** —Å –æ–±—Ä–µ–∑–∞–Ω–Ω—ã–º–∏ –∑–∞–≤–µ—Ä—à–∞—é—â–∏–º–∏ –ø—Ä–æ–±–µ–ª–∞–º–∏ (trimEnd) ‚Äî –≤–µ–¥—É—â–∏–µ –ø—Ä–æ–±–µ–ª—ã (–æ—Ç—Å—Ç—É–ø—ã) –ó–ù–ê–ß–ò–ú–´

–≠—Ç–æ –ø–æ–¥–∞—ë—Ç—Å—è –≤ —Ö–µ—à-—Ñ—É–Ω–∫—Ü–∏—é **FNV-1a**, —Å–≤–æ–¥–∏—Ç—Å—è –∫ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–º—É –º–æ–¥—É–ª—é –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–∞ –∏ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –∫–∞–∫ hex-—Å—Ç—Ä–æ–∫–∞.

### –•—É–∫–∏ –∏ tool –ø–ª–∞–≥–∏–Ω–∞

–ü–ª–∞–≥–∏–Ω —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç —á–µ—Ç—ã—Ä–µ —Ö—É–∫–∞ OpenCode –∏ –æ–¥–∏–Ω –∫–∞—Å—Ç–æ–º–Ω—ã–π tool:

| –•—É–∫ | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|-----|-----------|
| `tool.hashline_edit` | Hash-aware –ø—Ä–∞–≤–∫–∏ –ø–æ —Å—Å—ã–ª–∫–∞–º –≤—Ä–æ–¥–µ `5:a3f` –∏–ª–∏ `#HL 5:a3f|...` |
| `tool.execute.after` | –î–æ–±–∞–≤–ª—è–µ—Ç hashline-–∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏ –≤ –≤—ã–≤–æ–¥ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ —á—Ç–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤ |
| `tool.execute.before` | –£–±–∏—Ä–∞–µ—Ç hashline-–ø—Ä–µ—Ñ–∏–∫—Å—ã –∏–∑ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è |
| `chat.message` | –ê–Ω–Ω–æ—Ç–∏—Ä—É–µ—Ç `@file` —É–ø–æ–º–∏–Ω–∞–Ω–∏—è –≤ —Å–æ–æ–±—â–µ–Ω–∏—è—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –∞–Ω–Ω–æ—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç –≤–æ –≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ñ–∞–π–ª –∏ –ø–æ–¥–º–µ–Ω—è–µ—Ç URL) |
| `experimental.chat.system.transform` | –î–æ–±–∞–≤–ª—è–µ—Ç –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é hashline –≤ —Å–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç |

---

## üîå –ü—Ä–æ–≥—Ä–∞–º–º–Ω—ã–π API

–û—Å–Ω–æ–≤–Ω—ã–µ —É—Ç–∏–ª–∏—Ç—ã —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É—é—Ç—Å—è –∏–∑ —Å—É–±–ø—É—Ç–∏ `opencode-hashline/utils` (—á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ —Å –∑–∞–≥—Ä—É–∑—á–∏–∫–æ–º –ø–ª–∞–≥–∏–Ω–æ–≤ OpenCode, –∫–æ—Ç–æ—Ä—ã–π –≤—ã–∑—ã–≤–∞–µ—Ç –∫–∞–∂–¥—ã–π —ç–∫—Å–ø–æ—Ä—Ç –∫–∞–∫ —Ñ—É–Ω–∫—Ü–∏—é Plugin):

```typescript
import {
  computeLineHash,
  formatFileWithHashes,
  stripHashes,
  parseHashRef,
  normalizeHashRef,
  buildHashMap,
  getAdaptiveHashLength,
  verifyHash,
  resolveRange,
  replaceRange,
  applyHashEdit,
  HashlineCache,
  createHashline,
  shouldExclude,
  matchesGlob,
  resolveConfig,
  DEFAULT_PREFIX,
} from "opencode-hashline/utils";
```

### –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

```typescript
// –í—ã—á–∏—Å–ª–∏—Ç—å —Ö–µ—à –¥–ª—è –æ–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏
const hash = computeLineHash(0, "function hello() {"); // –Ω–∞–ø—Ä–∏–º–µ—Ä "a3f"

// –í—ã—á–∏—Å–ª–∏—Ç—å —Ö–µ—à —Å –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–π –¥–ª–∏–Ω–æ–π
const hash4 = computeLineHash(0, "function hello() {", 4); // –Ω–∞–ø—Ä–∏–º–µ—Ä "a3f2"

// –ê–Ω–Ω–æ—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞ (–∞–¥–∞–ø—Ç–∏–≤–Ω–∞—è –¥–ª–∏–Ω–∞ —Ö–µ—à–∞, —Å –ø—Ä–µ—Ñ–∏–∫—Å–æ–º #HL)
const annotated = formatFileWithHashes(fileContent);
// "#HL 1:a3|function hello() {\n#HL 2:f1|  return \"world\";\n#HL 3:0e|}"

// –ê–Ω–Ω–æ—Ç–∏—Ä–æ–≤–∞—Ç—å —Å –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–π –¥–ª–∏–Ω–æ–π —Ö–µ—à–∞
const annotated3 = formatFileWithHashes(fileContent, 3);

// –ê–Ω–Ω–æ—Ç–∏—Ä–æ–≤–∞—Ç—å –±–µ–∑ –ø—Ä–µ—Ñ–∏–∫—Å–∞ (legacy-—Ñ–æ—Ä–º–∞—Ç)
const annotatedLegacy = formatFileWithHashes(fileContent, undefined, false);

// –£–±—Ä–∞—Ç—å –∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏, –ø–æ–ª—É—á–∏—Ç—å –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ
const original = stripHashes(annotated);
```

### –•–µ—à-—Å—Å—ã–ª–∫–∏ –∏ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è

```typescript
// –†–∞–∑–æ–±—Ä–∞—Ç—å —Ö–µ—à-—Å—Å—ã–ª–∫—É
const { line, hash } = parseHashRef("2:f1c"); // { line: 2, hash: "f1c" }

// –ù–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É –∏–∑ –∞–Ω–Ω–æ—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —Å—Ç—Ä–æ–∫–∏
const ref = normalizeHashRef("#HL 2:f1c|const x = 1;"); // "2:f1c"

// –ü–æ—Å—Ç—Ä–æ–∏—Ç—å –∫–∞—Ä—Ç—É —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–π
const map = buildHashMap(fileContent); // Map<"2:f1c", 2>

// –í–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å —Ö–µ—à-—Å—Å—ã–ª–∫—É (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç hash.length, –∞ –Ω–µ —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞)
const result = verifyHash(2, "f1c", fileContent);
```

### Range-–æ–ø–µ—Ä–∞—Ü–∏–∏

```typescript
// –†–µ–∑–æ–ª–≤–∏—Ç—å –¥–∏–∞–ø–∞–∑–æ–Ω
const range = resolveRange("1:a3f", "3:0e7", fileContent);

// –ó–∞–º–µ–Ω–∏—Ç—å –¥–∏–∞–ø–∞–∑–æ–Ω
const newContent = replaceRange("1:a3f", "3:0e7", fileContent, "–Ω–æ–≤–æ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ");

// Hash-aware –æ–ø–µ—Ä–∞—Ü–∏—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è (replace/delete/insert_before/insert_after)
const edited = applyHashEdit(
  { operation: "replace", startRef: "1:a3f", endRef: "3:0e7", replacement: "–Ω–æ–≤–æ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ" },
  fileContent
).content;
```

### –£—Ç–∏–ª–∏—Ç—ã

```typescript
// –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –Ω—É–∂–Ω–æ –ª–∏ –∏—Å–∫–ª—é—á–∏—Ç—å —Ñ–∞–π–ª
const excluded = shouldExclude("node_modules/foo.js", ["**/node_modules/**"]);

// –°–æ–∑–¥–∞—Ç—å –Ω–∞—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä
const hl = createHashline({ cacheSize: 50, hashLength: 3 });
```

---

## üìä –ë–µ–Ω—á–º–∞—Ä–∫

### –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å: hashline vs str_replace vs apply_patch

–í—Å–µ —Ç—Ä–∏ –ø–æ–¥—Ö–æ–¥–∞ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã –Ω–∞ **60 —Ñ–∏–∫—Å—Ç—É—Ä–∞—Ö –∏–∑ [react-edit-benchmark](https://github.com/can1357/oh-my-pi/tree/main/packages/react-edit-benchmark)** ‚Äî –º—É—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ñ–∞–π–ª–∞—Ö React —Å –∏–∑–≤–µ—Å—Ç–Ω—ã–º–∏ –±–∞–≥–∞–º–∏ (–∏–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –±—É–ª–µ–≤—ã, –ø–µ—Ä–µ–ø—É—Ç–∞–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä—ã, —É–¥–∞–ª—ë–Ω–Ω—ã–µ guard-–∫–ª–∞—É–∑—ã –∏ —Ç.–¥.):

| | hashline | str_replace | apply_patch |
|---|:---:|:---:|:---:|
| **–ü—Ä–æ—à–ª–æ** | **60/60 (100%)** | 58/60 (96.7%) | **60/60 (100%)** |
| **–ü—Ä–æ–≤–∞–ª–µ–Ω–æ** | 0 | 2 | 0 |
| **–ù–µ–æ–¥–Ω–æ–∑–Ω–∞—á–Ω—ã–µ –ø—Ä–∞–≤–∫–∏** | 0 | 4 | 0 |

`apply_patch` —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–º–∏ —Å—Ç—Ä–æ–∫–∞–º–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–∞–∫ –∂–µ –Ω–∞–¥—ë–∂–Ω–æ, –∫–∞–∫ hashline ‚Äî **–ø—Ä–∏ —É—Å–ª–æ–≤–∏–∏, —á—Ç–æ –º–æ–¥–µ–ª—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –ø–∞—Ç—á**. –°–ª–∞–±–æ–µ –º–µ—Å—Ç–æ `apply_patch` ‚Äî –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç –æ–±—É—á–µ–Ω–∏—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –º–æ–¥–µ–ª–∏: –Ω–µ –æ–±—É—á–µ–Ω–Ω—ã–µ –ø–æ–¥ —ç—Ç–æ—Ç —Ñ–æ—Ä–º–∞—Ç –º–æ–¥–µ–ª–∏ –ø—Ä–æ–∏–∑–≤–æ–¥—è—Ç –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ diff-—ã (–ø—Ä–æ–ø—É—Å–∫–∞—é—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç, –ø—É—Ç–∞—é—Ç –æ—Ç—Å—Ç—É–ø—ã), —á—Ç–æ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ –ø—Ä–æ–≤–∞–ª—É –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –ø–∞—Ç—á–∞.

`str_replace` –ª–æ–º–∞–µ—Ç—Å—è, –∫–æ–≥–¥–∞ `old_string` –≤—Å—Ç—Ä–µ—á–∞–µ—Ç—Å—è –≤ —Ñ–∞–π–ª–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ (–ø–æ–≤—Ç–æ—Ä—è—é—â–∏–µ—Å—è guard-–∫–ª–∞—É–∑—ã, –ø–æ—Ö–æ–∂–∏–µ –±–ª–æ–∫–∏ –∫–æ–¥–∞). Hashline –∞–¥—Ä–µ—Å—É–µ—Ç –∫–∞–∂–¥—É—é —Å—Ç—Ä–æ–∫—É —É–Ω–∏–∫–∞–ª—å–Ω–æ —á–µ—Ä–µ–∑ `lineNumber:hash` ‚Äî –Ω–µ–æ–¥–Ω–æ–∑–Ω–∞—á–Ω–æ—Å—Ç—å –∏—Å–∫–ª—é—á–µ–Ω–∞, –º–æ–¥–µ–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –Ω–µ –Ω—É–∂–µ–Ω.

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∞–º–∏:
npx tsx benchmark/run.ts               # —Ä–µ–∂–∏–º hashline
npx tsx benchmark/run.ts --no-hash     # —Ä–µ–∂–∏–º str_replace
npx tsx benchmark/run.ts --apply-patch # —Ä–µ–∂–∏–º apply_patch
```

<details>
<summary>–û—à–∏–±–∫–∏ str_replace (–∫–∞—Ç–µ–≥–æ—Ä–∏—è structural)</summary>

- `structural-remove-early-return-001` ‚Äî `old_string` —Å–æ–≤–ø–∞–ª –≤ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –º–µ—Å—Ç–∞—Ö, –∑–∞–º–µ–Ω–∞ –ø—Ä–∏–º–µ–Ω–µ–Ω–∞ –Ω–µ –∫ —Ç–æ–º—É
- `structural-remove-early-return-002` ‚Äî –∞–Ω–∞–ª–æ–≥–∏—á–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞
- `structural-delete-statement-002` ‚Äî –Ω–µ–æ–¥–Ω–æ–∑–Ω–∞—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ (–ø–µ—Ä–≤–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ –æ–∫–∞–∑–∞–ª–æ—Å—å –≤–µ—Ä–Ω—ã–º)
- `structural-delete-statement-003` ‚Äî –Ω–µ–æ–¥–Ω–æ–∑–Ω–∞—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ (–ø–µ—Ä–≤–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ –æ–∫–∞–∑–∞–ª–æ—Å—å –≤–µ—Ä–Ω—ã–º)

</details>

### –†–∞—Å—Ö–æ–¥ —Ç–æ–∫–µ–Ω–æ–≤

–ê–Ω–Ω–æ—Ç–∞—Ü–∏–∏ hashline –¥–æ–±–∞–≤–ª—è—é—Ç –ø—Ä–µ—Ñ–∏–∫—Å `#HL <line>:<hash>|` (~12 —Å–∏–º–≤–æ–ª–æ–≤ / ~3 —Ç–æ–∫–µ–Ω–∞) –Ω–∞ —Å—Ç—Ä–æ–∫—É:

| | –ë–µ–∑ —Ö–µ—à–µ–π | –° —Ö–µ—à–∞–º–∏ | –û–≤–µ—Ä—Ö–µ–¥ |
|---|---:|---:|:---:|
| **–°–∏–º–≤–æ–ª—ã** | 404K | 564K | +40% |
| **–¢–æ–∫–µ–Ω—ã (~)** | ~101K | ~141K | +40% |

–û–≤–µ—Ä—Ö–µ–¥ —Å—Ç–∞–±–∏–ª—å–Ω–æ ~40% –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–∞. –î–ª—è —Ç–∏–ø–∏—á–Ω–æ–≥–æ —Ñ–∞–π–ª–∞ –Ω–∞ 200 —Å—Ç—Ä–æ–∫ (~800 —Ç–æ–∫–µ–Ω–æ–≤) hashline –¥–æ–±–∞–≤–ª—è–µ—Ç ~600 —Ç–æ–∫–µ–Ω–æ–≤ ‚Äî –ø—Ä–µ–Ω–µ–±—Ä–µ–∂–∏–º–æ –º–∞–ª–æ –ø—Ä–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–º –æ–∫–Ω–µ –≤ 200K.

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

| –†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ | –ê–Ω–Ω–æ—Ç–∞—Ü–∏—è | –ü—Ä–∞–≤–∫–∞ | –£–¥–∞–ª–µ–Ω–∏–µ —Ö–µ—à–µ–π |
|-------------:|:---------:|:------:|:--------------:|
| **10** —Å—Ç—Ä–æ–∫ | 0.05 –º—Å | 0.01 –º—Å | 0.03 –º—Å |
| **100** —Å—Ç—Ä–æ–∫ | 0.12 –º—Å | 0.02 –º—Å | 0.08 –º—Å |
| **1 000** —Å—Ç—Ä–æ–∫ | 0.95 –º—Å | 0.04 –º—Å | 0.60 –º—Å |
| **5 000** —Å—Ç—Ä–æ–∫ | 4.50 –º—Å | 0.08 –º—Å | 2.80 –º—Å |
| **10 000** —Å—Ç—Ä–æ–∫ | 9.20 –º—Å | 0.10 –º—Å | 5.50 –º—Å |

> –¢–∏–ø–∏—á–Ω—ã–π —Ñ–∞–π–ª –∏–∑ 1 000 —Å—Ç—Ä–æ–∫ –∞–Ω–Ω–æ—Ç–∏—Ä—É–µ—Ç—Å—è –∑–∞ **< 1 –º—Å** ‚Äî –Ω–µ–∑–∞–º–µ—Ç–Ω–æ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

---

## üßë‚Äçüíª –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
npm install

# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã
npm test

# –°–æ–±—Ä–∞—Ç—å
npm run build

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–æ–≤
npm run typecheck
```

---

## üí° –í–¥–æ—Ö–Ω–æ–≤–µ–Ω–∏–µ –∏ —Ç–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∞—è –±–∞–∑–∞

–ò–¥–µ—è hashline –≤–¥–æ—Ö–Ω–æ–≤–ª–µ–Ω–∞ –∫–æ–Ω—Ü–µ–ø—Ü–∏—è–º–∏ –∏–∑ **oh-my-pi** –æ—Ç [can1357](https://github.com/can1357/oh-my-pi) ‚Äî AI-—Ç—É–ª–∫–∏—Ç–∞ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ (coding agent CLI, unified LLM API, TUI-–±–∏–±–ª–∏–æ—Ç–µ–∫–∏) ‚Äî –∏ —Å—Ç–∞—Ç—å–∏ ¬´The Harness Problem¬ª (–ø—Ä–æ–±–ª–µ–º–∞ –æ–±–≤—è–∑–∫–∏).

**–°—É—Ç—å –ø—Ä–æ–±–ª–µ–º—ã:** —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ AI-–º–æ–¥–µ–ª–∏ –æ–±–ª–∞–¥–∞—é—Ç –æ–≥—Ä–æ–º–Ω—ã–º–∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—è–º–∏, –Ω–æ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã (harness), –∫–æ—Ç–æ—Ä—ã–µ –ø–µ—Ä–µ–¥–∞—é—Ç –º–æ–¥–µ–ª–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç –∏ –ø—Ä–∏–º–µ–Ω—è—é—Ç –µ—ë –ø—Ä–∞–≤–∫–∏ –∫ —Ñ–∞–π–ª–∞–º, —Ç–µ—Ä—è—é—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –∏ –ø–æ—Ä–æ–∂–¥–∞—é—Ç –æ—à–∏–±–∫–∏. –ú–æ–¥–µ–ª—å –≤–∏–¥–∏—Ç —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞, –Ω–æ –ø—Ä–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ –≤—ã–Ω—É–∂–¥–µ–Ω–∞ ¬´—É–≥–∞–¥—ã–≤–∞—Ç—å¬ª –∫–æ–Ω—Ç–µ–∫—Å—Ç –æ–∫—Ä—É–∂–∞—é—â–∏—Ö —Å—Ç—Ä–æ–∫. Search-and-replace –ª–æ–º–∞–µ—Ç—Å—è –Ω–∞ –¥—É–±–ª–∏–∫–∞—Ç–∞—Ö —Å—Ç—Ä–æ–∫, –∞ diff-—Ñ–æ—Ä–º–∞—Ç —Ç–æ–∂–µ –Ω–µ–Ω–∞–¥—ë–∂–µ–Ω –Ω–∞ –ø—Ä–∞–∫—Ç–∏–∫–µ.

Hashline —Ä–µ—à–∞–µ—Ç —ç—Ç—É –ø—Ä–æ–±–ª–µ–º—É, –ø—Ä–∏—Å–≤–∞–∏–≤–∞—è –∫–∞–∂–¥–æ–π —Å—Ç—Ä–æ–∫–µ –∫–æ—Ä–æ—Ç–∫–∏–π –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ö–µ—à-—Ç–µ–≥ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `2:f1c`), —á—Ç–æ –¥–µ–ª–∞–µ—Ç –∞–¥—Ä–µ—Å–∞—Ü–∏—é —Å—Ç—Ä–æ–∫ **—Ç–æ—á–Ω–æ–π –∏ –æ–¥–Ω–æ–∑–Ω–∞—á–Ω–æ–π**. –ú–æ–¥–µ–ª—å –º–æ–∂–µ—Ç —Å—Å—ã–ª–∞—Ç—å—Å—è –Ω–∞ –ª—é–±—É—é —Å—Ç—Ä–æ–∫—É –∏–ª–∏ –¥–∏–∞–ø–∞–∑–æ–Ω –±–µ–∑ –æ—à–∏–±–æ–∫ —Å–º–µ—â–µ–Ω–∏—è –∏ –ø—É—Ç–∞–Ω–∏—Ü—ã —Å –¥—É–±–ª–∏–∫–∞—Ç–∞–º–∏.

**–°—Å—ã–ª–∫–∏:**
- [oh-my-pi –æ—Ç can1357](https://github.com/can1357/oh-my-pi) ‚Äî AI-—Ç—É–ª–∫–∏—Ç –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏: coding agent CLI, unified LLM API, TUI-–±–∏–±–ª–∏–æ—Ç–µ–∫–∏
- [The Harness Problem](https://blog.can.ac/2026/02/12/the-harness-problem/) ‚Äî –±–ª–æ–≥-–ø–æ—Å—Ç —Å –ø–æ–¥—Ä–æ–±–Ω—ã–º –æ–ø–∏—Å–∞–Ω–∏–µ–º –ø—Ä–æ–±–ª–µ–º—ã
- [–°—Ç–∞—Ç—å—è –Ω–∞ –•–∞–±—Ä–µ](https://habr.com/ru/companies/bothub/news/995986/) ‚Äî –æ–ø–∏—Å–∞–Ω–∏–µ –ø–æ–¥—Ö–æ–¥–∞ –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ

---

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

[MIT](LICENSE) ¬© opencode-hashline contributors
